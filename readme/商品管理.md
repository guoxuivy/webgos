# 商品管理模块

## 1. 商品基础信息管理

### 商品档案库
建立标准化 3C 产品档案，包含：

- **基础属性**：类别（手机 / 电脑 / 平板等）、品牌、型号、发布年份、官方配置（默认内存、存储、颜色等）
- **扩展属性**：支持自定义字段（如手机是否支持 5G、电脑是否有独显等）
- **媒体资源**：官方图片、常见故障示意图、验机标准参考图

### 商品编码体系

- **统一编码规则**：前缀（类别）+ 品牌缩写 + 型号代码 + 状态码（如 "PH-APL-13Pro-95" 表示 95 新苹果 13Pro 手机）
- **序列号绑定**：每个二手商品唯一绑定原始设备序列号（SN 码 / IMEI 码），支持扫码录入和校验（防止串货或伪造）

## 2. 成色与状态管理

### 成色分级标准

- **预设分级**：99 新（未激活）、95 新（轻微使用痕迹）、90 新（明显使用痕迹）、85 新（划痕较多）等
- **分级规则配置**：支持按 "外观（屏幕 / 边框 / 后盖）""功能（按键 / 摄像头 / 电池健康）""维修史" 等维度自定义分级标准
- **成色可视化**：上传实际商品照片，标记瑕疵位置（如 "屏幕左上角划痕"），关联成色等级

### 商品状态管理

- **全生命周期状态定义**：待检测 → 检测不合格（报废 / 退回） → 待维修 → 维修中 → 已翻新 → 可销售 → 已售出 → 售后中（维修 / 退换）
- **状态编码规范**：
  - PENDING_CHECK：待检测
  - CHECK_FAILED：检测不合格
  - PENDING_REPAIR：待维修
  - REPAIRING：维修中
  - REFURBISHED：已翻新
  - FOR_SALE：可销售
  - SOLD：已售出
  - AFTER_SALES：售后中
- **状态流转规则**：配置状态变更条件（如 "维修完成后自动从'REPAIRING'转为'REFURBISHED'"），并记录变更人、时间、原因

## 3. 定价与版本管理

### 动态定价模型

- **基准价设置**：基于型号、官方指导价、市场流通价设定基础回收价和销售价
- **成色调价**：按成色等级设置折扣（如 95 新为基准价的 90%，90 新为 80%）
- **配置调价**：针对非官方默认配置（如扩容机、换屏机）设置价格系数（如扩容机降价 20%）
- **时效调价**：支持按库存时长自动调价（如滞销 30 天以上降价 5%）

## 4. 商品标签与搜索

- **多维度标签**：自动生成或手动添加标签（如 "原装无拆修""电池效率 90%+""支持以旧换新"）
- **智能搜索**：支持按 "品牌 + 型号 + 成色 + 配置 + 状态" 组合搜索，支持序列号精确查询，快速定位商品

## 5. 商品文档管理

- **文档关联**：关联回收验机报告、维修记录、翻新流程单、质检合格证等文档
- **格式支持**：支持 PDF、图片格式上传，可追溯商品历史处理记录

## 6. 商品管理模块核心表

### 6.1 商品类别表（product_category）

**用途**：管理 3C 产品的类别体系（如手机、电脑、平板等）

| 字段名 | 类型 | 长度 | 约束 | 说明 |
|--------|------|------|------|------|
| category_id | INT | 11 | PRIMARY KEY, AUTO_INCREMENT | 类别 ID |
| category_name | VARCHAR | 50 | NOT NULL | 类别名称（如 "手机"、"笔记本电脑"） |
| parent_id | INT | 11 | FOREIGN KEY | 父类别 ID（用于多级分类，如 "手机"→"智能手机"） |
| sort_order | INT | 3 | DEFAULT 0 | 排序权重 |
| is_active | TINYINT | 1 | DEFAULT 1 | 是否启用（1 = 启用，0 = 禁用） |
| create_time | DATETIME | - | DEFAULT CURRENT_TIMESTAMP | 创建时间 |

**索引**：idx_parent_id（parent_id）

### 6.2 商品品牌表（product_brand）

**用途**：管理 3C 产品品牌（如苹果、华为、小米等）

| 字段名 | 类型 | 长度 | 约束 | 说明 |
|--------|------|------|------|------|
| brand_id | INT | 11 | PRIMARY KEY, AUTO_INCREMENT | 品牌 ID |
| brand_name | VARCHAR | 50 | NOT NULL, UNIQUE | 品牌名称 |
| logo_url | VARCHAR | 255 | NULL | 品牌 LOGO 地址 |
| is_active | TINYINT | 1 | DEFAULT 1 | 是否启用 |
| create_time | DATETIME | - | DEFAULT CURRENT_TIMESTAMP | 创建时间 |

### 6.3 商品型号表（product_model）

**用途**：管理具体商品型号（如 iPhone 13 Pro、华为 Mate 50）

| 字段名 | 类型 | 长度 | 约束 | 说明 |
|--------|------|------|------|------|
| model_id | INT | 11 | PRIMARY KEY, AUTO_INCREMENT | 型号 ID |
| category_id | INT | 11 | FOREIGN KEY (product_category) | 所属类别 ID |
| brand_id | INT | 11 | FOREIGN KEY (product_brand) | 所属品牌 ID |
| model_name | VARCHAR | 100 | NOT NULL | 型号名称（如 "iPhone 13 Pro"） |
| release_year | INT | 4 | NULL | 发布年份 |
| official_price | DECIMAL | 10,2 | NULL | 官方指导价（元） |
| specs | JSON | - | NULL | 官方默认配置（如 {"内存":"8G","存储":"256G","颜色":"黑色"}） |
| is_active | TINYINT | 1 | DEFAULT 1 | 是否启用 |
| create_time | DATETIME | - | DEFAULT CURRENT_TIMESTAMP | 创建时间 |

**索引**：idx_category_brand（category_id, brand_id）、idx_model_name（model_name）

### 6.4 成色等级表（product_condition）

**用途**：定义二手商品的成色标准（如 99 新、95 新）

| 字段名 | 类型 | 长度 | 约束 | 说明 |
|--------|------|------|------|------|
| condition_id | INT | 11 | PRIMARY KEY, AUTO_INCREMENT | 成色 ID |
| condition_name | VARCHAR | 20 | NOT NULL | 成色名称（如 "99 新"） |
| description | TEXT | - | NULL | 成色描述（如 "无使用痕迹，原装未拆修"） |
| score | INT | 3 | NOT NULL | 成色评分（如 99、95，用于定价） |
| price_discount | DECIMAL | 5,2 | NOT NULL | 价格折扣（相对于全新的比例，如 0.95=95 折） |
| sort_order | INT | 3 | DEFAULT 0 | 排序权重（从高到低） |

**索引**：idx_score（score）

### 6.5 商品实例表（product_instance）

**用途**：记录单个二手 3C 商品的唯一信息（核心表，每台设备一条记录）

| 字段名 | 类型 | 长度 | 约束 | 说明 |
|--------|------|------|------|------|
| instance_id | BIGINT | 20 | PRIMARY KEY, AUTO_INCREMENT | 商品实例 ID（系统内部唯一标识） |
| serial_number | VARCHAR | 50 | NOT NULL, UNIQUE | 设备序列号（SN/IMEI，外部唯一标识） |
| model_id | INT | 11 | FOREIGN KEY (product_model) | 所属型号 ID |
| condition_id | INT | 11 | FOREIGN KEY (product_condition) | 成色 ID |
| status | VARCHAR | 20 | NOT NULL DEFAULT 'PENDING_CHECK' | 当前状态（如 "PENDING_CHECK"=待检测、"FOR_SALE"=可销售） |
| defect_desc | TEXT | - | NULL | 瑕疵描述（如 "屏幕左上角划痕"） |
| defect_images | JSON | - | NULL | 瑕疵图片 URL 列表 |
| battery_health | INT | 3 | NULL | 电池健康度（如 90%，仅手机 / 平板） |
| storage_capacity | VARCHAR | 20 | NULL | 实际存储容量（如 "256G"），替代原版本配置概念 |
| purchase_date | DATE | - | NULL | 原购买日期（客户提供） |
| recycle_price | DECIMAL | 10,2 | NOT NULL | 回收价格（元） |
| base_sale_price | DECIMAL | 10,2 | NOT NULL | 基础销售价（未计算折扣前） |
| recycle_order_id | BIGINT | 20 | NULL | 关联回收单 ID（来源） |
| create_time | DATETIME | - | DEFAULT CURRENT_TIMESTAMP | 创建时间（回收录入时间） |
| update_time | DATETIME | - | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 状态更新时间 |

**索引**：idx_serial_number（serial_number）、idx_model_condition（model_id, condition_id）、idx_status_id（status_id）

### 6.6 商品标签表（product_tag）

**用途**：管理商品标签（如 "原装无拆修"、"电池换新"）

| 字段名 | 类型 | 长度 | 约束 | 说明 |
|--------|------|------|------|------|
| tag_id | INT | 11 | PRIMARY KEY, AUTO_INCREMENT | 标签 ID |
| tag_name | VARCHAR | 50 | NOT NULL, UNIQUE | 标签名称 |
| tag_color | VARCHAR | 20 | DEFAULT '#666666' | 标签展示颜色 |
| is_active | TINYINT | 1 | DEFAULT 1 | 是否启用 |

### 6.7 商品 - 标签关联表（product_instance_tag）

**用途**：建立商品实例与标签的多对多关系

| 字段名 | 类型 | 长度 | 约束 | 说明 |
|--------|------|------|------|------|
| id | BIGINT | 20 | PRIMARY KEY, AUTO_INCREMENT | 关联 ID |
| instance_id | BIGINT | 20 | FOREIGN KEY (product_instance) | 商品实例 ID |
| tag_id | INT | 11 | FOREIGN KEY (product_tag) | 标签 ID |
| create_time | DATETIME | - | DEFAULT CURRENT_TIMESTAMP | 关联时间 |

**索引**：idx_instance_tag（instance_id, tag_id）、idx_tag_instance（tag_id, instance_id）

## 7. 与库存管理系统的集成

### 7.1 集成说明

商品管理系统与库存管理系统通过商品实例表（product_instance）进行集成。每个商品实例在库存系统中都有对应的库存记录，确保商品信息与库存信息的一致性。

- **一对一关联**：每个商品实例（instance_id）在库存系统中都有唯一对应的库存记录
- **状态同步**：商品状态变更时，库存系统中的状态也会相应更新
- **仓库管理**：商品在库存系统中的位置通过仓库ID进行管理

### 7.2 数据一致性保证

为确保商品管理系统与库存管理系统之间的数据一致性，需要遵循以下规则：

1. 商品实例创建时，同时在库存系统中创建对应的库存记录
2. 商品状态变更时，同步更新库存记录中的相关信息
3. 商品在不同仓库间调拨时，更新库存记录中的仓库信息
4. 商品销售出库时，更新商品状态并减少库存数量